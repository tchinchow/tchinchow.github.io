/*!
 * leaflet-elevation
 * A Leaflet plugin that allows to add elevation profiles using d3js
 * https://github.com/Raruto/leaflet-elevation/
 * @author Raruto <https://github.com/Raruto>
 * @version 1.0.0
 */

!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";!function(t,i){"function"==typeof define&&define.amd?define(["leaflet"],t):"object"==typeof exports&&(module.exports=t(require("leaflet"))),void 0!==i&&i.L&&t(i.L)}((function(t){return t.locales={},t.locale=null,t.registerLocale=function(i,e){t.locales[i]=t.Util.extend({},t.locales[i],e)},t.setLocale=function(i){t.locale=i},t.i18n=t._=function(i,e){t.locale&&t.locales[t.locale]&&t.locales[t.locale][i]&&(i=t.locales[t.locale][i]);try{i=t.Util.template(i,e)}catch(t){}return i}}),window),L.Control.Elevation=L.Control.extend({includes:L.Evented?L.Evented.prototype:L.Mixin.Events,options:{autohide:!0,autohideMarker:!0,collapsed:!1,controlButton:{iconCssClass:"elevation-toggle-icon",title:"Elevation"},detached:!0,distanceFactor:1,downloadLink:"link",elevationDiv:"#elevation-div",followMarker:!0,forceAxisBounds:!1,gpxOptions:{async:!0,marker_options:{startIconUrl:null,endIconUrl:null,shadowUrl:null,wptIcons:{"":L.divIcon({className:"elevation-waypoint-marker",html:'<i class="elevation-waypoint-icon"></i>',iconSize:[30,30],iconAnchor:[8,30]})}}},height:200,heightFactor:1,hoverNumber:{decimalsX:2,decimalsY:0,formatter:void 0},imperial:!1,interpolation:"curveLinear",lazyLoadJS:!0,legend:!0,loadData:{defer:!1,lazy:!1},marker:"elevation-line",markerIcon:L.divIcon({className:"elevation-position-marker",html:'<i class="elevation-position-icon"></i>',iconSize:[32,32],iconAnchor:[16,16]}),placeholder:!1,position:"topright",polyline:{className:"elevation-polyline",color:"#000",opacity:.75,weight:5,lineCap:"round"},reverseCoords:!1,skipNullZCoords:!1,theme:"lightblue-theme",margins:{top:10,right:20,bottom:30,left:50},responsive:!0,summary:"inline",width:600,xLabel:"km",xTicks:void 0,yAxisMax:void 0,yAxisMin:void 0,yLabel:"m",yTicks:void 0,zFollow:13},__mileFactor:.621371,__footFactor:3.28084,addData:function(t,i){this._addData(t),this._container&&this._applyData(),null==i&&t.on&&(i=t),i&&(i._path&&L.DomUtil.addClass(i._path,this.options.polyline.className+" "+this.options.theme),i.on("mousemove",this._mousemoveLayerHandler,this).on("mouseout",this._mouseoutHandler,this)),this.track_info=L.extend({},this.track_info,{distance:this._distance,elevation_max:this._maxElevation,elevation_min:this._minElevation}),this._layers=this._layers||{},this._layers[L.Util.stamp(i)]=i;var e={data:t,layer:i,track_info:this.track_info};this.fire&&this.fire("eledata_added",e,!0),this._map&&this._map.fire("eledata_added",e,!0)},addTo:function(t){return this.options.detached?this._appendElevationDiv(t._container).appendChild(this.onAdd(t)):L.Control.prototype.addTo.call(this,t),this},clear:function(){this._clearPath(),this._clearChart(),this._clearData(),this.fire&&this.fire("eledata_clear"),this._map&&this._map.fire("eledata_clear")},disableDragging:function(){this._draggingEnabled=!1,this._resetDrag()},enableDragging:function(){this._draggingEnabled=!0},fitBounds:function(t){t=t||this._fullExtent,this._map&&t&&this._map.fitBounds(t)},getZFollow:function(){return this._zFollow},hide:function(){this._container.style.display="none"},initialize:function(t){this.options.autohide=void 0!==t.autohide?t.autohide:!L.Browser.mobile,this.options=this._deepMerge({},this.options,t),this._draggingEnabled=!L.Browser.mobile,this._chartEnabled=!0,t.imperial?(this._distanceFactor=this.__mileFactor,this._heightFactor=this.__footFactor,this._xLabel="mi",this._yLabel="ft"):(this._distanceFactor=this.options.distanceFactor,this._heightFactor=this.options.heightFactor,this._xLabel=this.options.xLabel,this._yLabel=this.options.yLabel),this._zFollow=this.options.zFollow,this.options.followMarker&&(this._setMapView=L.Util.throttle(this._setMapView,300,this)),this.options.placeholder&&(this.options.loadData.lazy=this.options.loadData.defer=!0)},load:function(t,i){this.loadData(t,i)},loadChart:function(t){this.addTo(t)},loadData:function(t,i){(i=L.extend({},this.options.loadData,i)).defer?this.loadDefer(t,i):i.lazy?this.loadLazy(t,i):this._isXMLDoc(t)?this.loadGPX(t):this._isJSONDoc(t)?this.loadGeoJSON(t):this.loadFile(t)},loadDefer:function(t,i){(i=L.extend({},this.options.loadData,i)).defer=!1,"complete"!==document.readyState?window.addEventListener("load",L.bind(this.loadData,this,t,i),{once:!0}):this.loadData(t,i)},loadFile:function(t){this._downloadURL=t;try{var i=new XMLHttpRequest;i.responseType="text",i.open("GET",t),i.onload=function(){if(200!==i.status)throw"Error "+i.status+" while fetching remote file: "+t;this.loadData(i.response,{lazy:!1,defer:!1})}.bind(this),i.send()}catch(t){console.warn(t)}},loadGeoJSON:function(t){"string"==typeof t&&(t=JSON.parse(t)),this.options.theme&&(this.options.polyline.className+=" "+this.options.theme),this.layer=this.geojson=L.geoJson(t,{style:function(t){return this.options.polyline}.bind(this),onEachFeature:function(i,e){this.addData(i,e),this.track_info=L.extend({},this.track_info,{type:"geojson",name:t.name,distance:this._distance,elevation_max:this._maxElevation,elevation_min:this._minElevation})}.bind(this)}),this._map?(this._map.once("layeradd",(function(i){this.fitBounds(this.layer.getBounds());var e={data:t,layer:this.layer,name:this.track_info.name,track_info:this.track_info};this.fire&&this.fire("eledata_loaded",e,!0),this._map&&this._map.fire("eledata_loaded",e,!0)}),this),this.layer.addTo(this._map)):console.warn("Undefined elevation map object")},loadGPX:function(t){var i=function(t){this.options.gpxOptions.polyline_options=L.extend({},this.options.polyline,this.options.gpxOptions.polyline_options),this.options.theme&&(this.options.gpxOptions.polyline_options.className+=" "+this.options.theme),this.layer=this.gpx=new L.GPX(t,this.options.gpxOptions),this.layer.on("loaded",(function(t){this.fitBounds(t.target.getBounds())}),this),this.layer.on("addpoint",(function(t){t.point._popup&&(t.point._popup.options.className="elevation-popup",t.point._popup._content=decodeURI(t.point._popup._content)),t.point._popup&&t.point._popup._content&&t.point.bindTooltip(t.point._popup._content,{direction:"top",sticky:!0,opacity:1,className:"elevation-tooltip"}).openTooltip()})),this.layer.once("addline",(function(i){this.addData(i.line),this.track_info=L.extend({},this.track_info,{type:"gpx",name:this.layer.get_name(),distance:this._distance,elevation_max:this._maxElevation,elevation_min:this._minElevation});var e={data:t,layer:this.layer,name:this.track_info.name,track_info:this.track_info};this.fire&&this.fire("eledata_loaded",e,!0),this._map&&this._map.fire("eledata_loaded",e,!0)}),this),this._map?this.layer.addTo(this._map):console.warn("Undefined elevation map object")}.bind(this,t);"function"!=typeof L.GPX&&this.options.lazyLoadJS?(L.Control.Elevation._gpxLazyLoader=this._lazyLoadJS("https://unpkg.com/leaflet-gpx@1.5.0/gpx.js",L.Control.Elevation._gpxLazyLoader),L.Control.Elevation._gpxLazyLoader.then(i)):i.call()},loadLazy:function(t,i){(i=L.extend({},this.options.loadData,i)).lazy=!1;let e=!1,a=L.bind((function(t){e||(L.Util.requestAnimFrame((function(){this._isVisible(this.placeholder)&&(window.removeEventListener("scroll",a),this.loadData(t,i),this.once("eledata_loaded",(function(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder)}),this)),e=!1}),this),e=!0)}),this,t);window.addEventListener("scroll",a),this.placeholder&&this.placeholder.addEventListener("mouseenter",a,{once:!0}),a()},onAdd:function(t){this._map=t;var i=this._container=L.DomUtil.create("div","elevation-control elevation");if(this.options.detached||L.DomUtil.addClass(i,"leaflet-control"),this.options.theme&&L.DomUtil.addClass(i,this.options.theme),this.options.placeholder&&!this._data){if(this.placeholder=L.DomUtil.create("img","elevation-placeholder"),"string"==typeof this.options.placeholder)this.placeholder.src=this.options.placeholder,this.placeholder.alt="";else for(let t in this.options.placeholder)this.placeholder.setAttribute(t,this.options.placeholder[t]);i.insertBefore(this.placeholder,i.firstChild)}var e=function(t,i){this._initToggle(i),this._initChart(i),this._applyData(),this._map.on("zoom viewreset zoomanim",this._hidePositionMarker,this),this._map.on("resize",this._resetView,this),this._map.on("resize",this._resizeChart,this),this._map.on("mousedown",this._resetDrag,this),this._map.on("eledata_loaded",this._updateSummary,this),L.DomEvent.on(this._map._container,"mousewheel",this._resetDrag,this),L.DomEvent.on(this._map._container,"touchstart",this._resetDrag,this)}.bind(this,t,i);return"object"!=typeof d3&&this.options.lazyLoadJS?(L.Control.Elevation._d3LazyLoader=this._lazyLoadJS("https://unpkg.com/d3@5.15.0/dist/d3.min.js",L.Control.Elevation._d3LazyLoader),L.Control.Elevation._d3LazyLoader.then(e)):e.call(),i},onRemove:function(t){this._container=null},redraw:function(){this._resizeChart()},setZFollow:function(t){this._zFollow=t},show:function(){this._container.style.display="block"},_addData:function(t){var i,e=t&&t.geometry&&t.geometry;if(e)switch(e.type){case"LineString":this._addGeoJSONData(e.coordinates);break;case"MultiLineString":for(i=0;i<e.coordinates.length;i++)this._addGeoJSONData(e.coordinates[i]);break;default:console.warn("Unsopperted GeoJSON feature geometry type:"+e.type)}if(t&&"FeatureCollection"===t.type)for(i=0;i<t.features.length;i++)this._addData(t.features[i]);t&&t._latlngs&&this._addGPXdata(t._latlngs)},_addGeoJSONData:function(t){if(t)for(var i=0;i<t.length;i++)this._addPoint(t[i][1],t[i][0],t[i][2])},_addGPXdata:function(t){if(t)for(var i=0;i<t.length;i++)this._addPoint(t[i].lat,t[i].lng,t[i].meta.ele)},_addPoint:function(t,i,e){if(this.options.reverseCoords){var a=t;t=i,i=a}var s=this._data||[],o=this._maxElevation||-1/0,n=this._minElevation||1/0,r=this._distance||0,h=new L.LatLng(t,i),l=s.length?s[s.length-1].latlng:h,d=h.distanceTo(l)*this._distanceFactor;if(r+=Math.round(d/1e3*1e5)/1e5,!this.options.skipNullZCoords&&s.length>0){var c=s[s.length-1].z;if(isNaN(c)){var _=this._lastValidZ,p=e*this._heightFactor;isNaN(_)||isNaN(p)?isNaN(_)?isNaN(p)||(c=p):c=_:c=(_+p)/2,isNaN(c)?s.splice(s.length-1,1):s[s.length-1].z=c}}e*=this._heightFactor,isNaN(e)||(o=o<e?e:o,n=n>e?e:n,this._lastValidZ=e),s.push({dist:r,x:t,y:i,z:e,latlng:h}),this._data=s,this._distance=r,this._maxElevation=o,this._minElevation=n},_appendChart:function(t){var i=t.append("g").attr("transform","translate("+this.options.margins.left+","+this.options.margins.top+")");this._appendGrid(i),this._appendAreaPath(i),this._appendAxis(i),this._appendFocusRect(i),this._appendMouseFocusG(i),this._appendLegend(i)},_appendElevationDiv:function(t){var i=document.querySelector(this.options.elevationDiv);return i||(i=L.DomUtil.create("div","leaflet-control elevation elevation-div"),this.options.elevationDiv="#elevation-div_"+Math.random().toString(36).substr(2,9),i.id=this.options.elevationDiv.substr(1),t.parentNode.insertBefore(i,t.nextSibling)),this.options.detached&&(L.DomUtil.addClass(i,"elevation-detached"),L.DomUtil.removeClass(i,"leaflet-control")),this.eleDiv=i,this.eleDiv},_appendXaxis:function(t){t.append("g").attr("class","x axis").attr("transform","translate(0,"+this._height()+")").call(d3.axisBottom().scale(this._x).ticks(this.options.xTicks)).append("text").attr("x",this._width()+6).attr("y",30).text(this._xLabel)},_appendXGrid:function(t){t.append("g").attr("class","x grid").attr("transform","translate(0,"+this._height()+")").call(d3.axisBottom().scale(this._x).ticks(this.options.xTicks).tickSize(-this._height()).tickFormat(""))},_appendYaxis:function(t){t.append("g").attr("class","y axis").call(d3.axisLeft().scale(this._y).ticks(this.options.yTicks)).append("text").attr("x",-30).attr("y",3).text(this._yLabel)},_appendYGrid:function(t){t.append("g").attr("class","y grid").call(d3.axisLeft().scale(this._y).ticks(this.options.yTicks).tickSize(-this._width()).tickFormat(""))},_appendAreaPath:function(t){this._areapath=t.append("path").attr("class","area")},_appendAxis:function(t){this._axis=t.append("g").attr("class","axis"),this._appendXaxis(this._axis),this._appendYaxis(this._axis)},_appendFocusRect:function(t){var i=this._focusRect=t.append("rect").attr("width",this._width()).attr("height",this._height()).style("fill","none").style("stroke","none").style("pointer-events","all");L.Browser.mobile&&(i.on("touchmove.drag",this._dragHandler.bind(this)).on("touchstart.drag",this._dragStartHandler.bind(this)).on("touchstart.focus",this._mousemoveHandler.bind(this)).on("touchmove.focus",this._mousemoveHandler.bind(this)),L.DomEvent.on(this._container,"touchend",this._dragEndHandler,this)),i.on("mousemove.drag",this._dragHandler.bind(this)).on("mousedown.drag",this._dragStartHandler.bind(this)).on("mouseenter.focus",this._mouseenterHandler.bind(this)).on("mousemove.focus",this._mousemoveHandler.bind(this)).on("mouseout.focus",this._mouseoutHandler.bind(this)),L.DomEvent.on(this._container,"mouseup",this._dragEndHandler,this)},_appendGrid:function(t){this._grid=t.append("g").attr("class","grid"),this._appendXGrid(this._grid),this._appendYGrid(this._grid)},_appendMouseFocusG:function(t){var i=this._focusG=t.append("g").attr("class","mouse-focus-group");this._mousefocus=i.append("svg:line").attr("class","mouse-focus-line").attr("x2","0").attr("y2","0").attr("x1","0").attr("y1","0"),this._focuslabelrect=i.append("rect").attr("class","mouse-focus-label").attr("x",0).attr("y",0).attr("width",0).attr("height",0).attr("rx",3).attr("ry",3),this._focuslabeltext=i.append("svg:text").attr("class","mouse-focus-label-text"),this._focuslabelY=this._focuslabeltext.append("svg:tspan").attr("class","mouse-focus-label-y").attr("dy","-1em"),this._focuslabelX=this._focuslabeltext.append("svg:tspan").attr("class","mouse-focus-label-x").attr("dy","2em")},_appendLegend:function(t){if(this.options.legend){var i=this._legend=t.append("g").attr("class","legend"),e=this._altitudeLegend=this._legend.append("g").attr("class","legend-altitude");e.append("rect").attr("class","area").attr("x",this._width()/2-50).attr("y",this._height()+this.options.margins.bottom-17).attr("width",50).attr("height",5).attr("opacity",.75),e.append("text").text("Altitude").attr("x",this._width()/2+5).attr("font-size",10).style("text-decoration-thickness","2px").style("font-weight","700").attr("y",this._height()+this.options.margins.bottom-11),i.on("click",function(){this._chartEnabled?(this._clearChart(),this._clearPath(),this._chartEnabled=!1):(this._resizeChart(),this._chartEnabled=!0)}.bind(this))}},_appendPositionMarker:function(t){var i=this.options.theme,e=t.select("g");this._mouseHeightFocus=e.append("svg:line").attr("class",i+" height-focus line").attr("x2",0).attr("y2",0).attr("x1",0).attr("y1",0),this._pointG=e.append("g"),this._pointG.append("svg:circle").attr("class",i+" height-focus circle-lower").attr("r",6).attr("cx",0).attr("cy",0),this._mouseHeightFocusLabel=e.append("svg:text").attr("class",i+" height-focus-label").style("pointer-events","none")},_applyData:function(){if(this._data){var t=d3.extent(this._data,(function(t){return t.dist})),i=d3.extent(this._data,(function(t){return t.z})),e=this.options;void 0!==e.yAxisMin&&(e.yAxisMin<i[0]||e.forceAxisBounds)&&(i[0]=e.yAxisMin),void 0!==e.yAxisMax&&(e.yAxisMax>i[1]||e.forceAxisBounds)&&(i[1]=e.yAxisMax),this._x.domain(t),this._y.domain(i),this._areapath.datum(this._data).attr("d",this._area),this._updateAxis(),this._fullExtent=this._calculateFullExtent(this._data)}},_calculateFullExtent:function(t){if(!t||t.length<1)throw new Error("no data in parameters");var i=new L.latLngBounds(t[0].latlng,t[0].latlng);return t.forEach((function(t){i.extend(t.latlng)})),i},_clearChart:function(){this._resetDrag(),this._areapath&&(this._areapath.attr("d","M0 0"),this._x.domain([0,1]),this._y.domain([0,1]),this._updateAxis()),this._altitudeLegend&&this._altitudeLegend.select("text").style("text-decoration-line","line-through")},_clearData:function(){this._data=null,this._distance=null,this._maxElevation=null,this._minElevation=null,this.track_info=null,this._layers=null},_clearPath:function(){for(var t in this._hidePositionMarker(),this._layers)L.DomUtil.removeClass(this._layers[t]._path,this.options.polyline.className),L.DomUtil.removeClass(this._layers[t]._path,this.options.theme)},_collapse:function(){this._container&&(L.DomUtil.removeClass(this._container,"elevation-expanded"),L.DomUtil.addClass(this._container,"elevation-collapsed"))},_deepMerge:function(t,...i){if(!i.length)return t;const e=i.shift();if(this._isObject(t)&&this._isObject(e))for(const i in e)this._isObject(e[i])?(t[i]||Object.assign(t,{[i]:{}}),this._deepMerge(t[i],e[i])):Object.assign(t,{[i]:e[i]});return this._deepMerge(t,...i)},_saveFile:function(t){var i=document,e=i.createElement("a"),a=i.body;e.href=t,e.target="_new",e.download="",e.style.display="none",a.appendChild(e),e.click(),a.removeChild(e)},_dragHandler:function(){d3.event.preventDefault(),d3.event.stopPropagation(),this._gotDragged=!0,this._drawDragRectangle()},_dragEndHandler:function(){if(!this._dragStartCoords||!this._dragCurrentCoords||!this._gotDragged)return this._dragStartCoords=null,this._gotDragged=!1,void(this._draggingEnabled&&this._resetDrag());var t=this._findItemForX(this._dragStartCoords[0]),i=this._findItemForX(this._dragCurrentCoords[0]);if(t!=i){this._hidePositionMarker(),this._fitSection(t,i),this._dragStartCoords=null,this._gotDragged=!1;var e={data:{dragstart:this._data[t],dragend:this._data[i]}};this.fire&&this.fire("elechart_dragged",e,!0),this._map&&this._map.fire("elechart_dragged",e,!0)}},_dragStartHandler:function(){d3.event.preventDefault(),d3.event.stopPropagation(),this._gotDragged=!1,this._dragStartCoords=d3.mouse(this._focusRect.node())},_drawDragRectangle:function(){if(this._dragStartCoords&&this._draggingEnabled){var t=this._dragCurrentCoords=d3.mouse(this._focusRect.node()),i=Math.min(this._dragStartCoords[0],t[0]),e=Math.max(this._dragStartCoords[0],t[0]);if(this._dragRectangle||this._dragRectangleG)this._dragRectangle.attr("width",e-i).attr("x",i);else{var a=d3.select(this._container).select("svg").select("g");this._dragRectangleG=a.insert("g",".mouse-focus-group"),this._dragRectangle=this._dragRectangleG.append("rect").attr("width",e-i).attr("height",this._height()).attr("x",i).attr("class","mouse-drag").style("pointer-events","none")}}},_expand:function(){this._container&&(L.DomUtil.removeClass(this._container,"elevation-collapsed"),L.DomUtil.addClass(this._container,"elevation-expanded"))},_findItemForLatLng:function(t){var i=null,e=1/0;return this._data.forEach((function(a){var s=t.distanceTo(a.latlng);s<e&&(e=s,i=a)})),i},_findItemForX:function(t){var i=d3.bisector((function(t){return t.dist})).left,e=this._x.invert(t);return i(this._data,e)},_fitSection:function(t,i){var e=Math.min(t,i),a=Math.max(t,i),s=this._calculateFullExtent(this._data.slice(e,a));this.fitBounds(s)},_formatter:function(t,i,e){var a,s=(a=0===i?Math.round(t)+"":L.Util.formatNum(t,i)+"").split(".");if(s[1]){for(var o=i-s[1].length;o>0;o--)s[1]+="0";a=s.join(e||".")}return a},_height:function(){var t=this.options;return t.height-t.margins.top-t.margins.bottom},_hidePositionMarker:function(){this.options.autohideMarker&&(this._selectedItem=null,this._marker&&(this._map&&this._map.removeLayer(this._marker),this._marker=null),this._mouseHeightFocus&&(this._mouseHeightFocus.style("visibility","hidden"),this._mouseHeightFocusLabel.style("visibility","hidden")),this._pointG&&this._pointG.style("visibility","hidden"),this._focusG&&this._focusG.style("visibility","hidden"))},_initChart:function(){var t=this.options;if(t.xTicks=t.xTicks||Math.round(this._width()/75),t.yTicks=t.yTicks||Math.round(this._height()/30),t.hoverNumber.formatter=t.hoverNumber.formatter||this._formatter,t.responsive)if(t.detached){var i=this.eleDiv.offsetWidth,e=this.eleDiv.offsetHeight;t.width=i>0?i:t.width,t.height=e-20>0?e-20:t.height}else{t._maxWidth=t._maxWidth>t.width?t._maxWidth:t.width;var a=this._map._container.clientWidth;t.width=t._maxWidth>a?a-30:t.width}var s=this._x=d3.scaleLinear().range([0,this._width()]),o=this._y=d3.scaleLinear().range([this._height(),0]),n="function"==typeof t.interpolation?t.interpolation:d3[t.interpolation],r=(this._area=d3.area().curve(n).x((function(t){return t.xDiagCoord=s(t.dist)})).y0(this._height()).y1((function(t){return o(t.z)})),this._line=d3.line().x((function(t){return d3.mouse(h.select("g"))[0]})).y((function(t){return this._height()})),d3.select(this._container)),h=r.append("svg").attr("class","background").attr("width",t.width).attr("height",t.height);this.summaryDiv=r.append("div").attr("class","elevation-summary "+this.options.summary+"-summary").node();this._appendChart(h),this._updateSummary()},_initToggle:function(t){if(t.setAttribute("aria-haspopup",!0),this.options.detached||L.DomEvent.disableClickPropagation(t),L.Browser.mobile&&L.DomEvent.on(t,"click",L.DomEvent.stopPropagation),L.DomEvent.on(t,"mousewheel",this._mousewheelHandler,this),!this.options.detached){var i="elevation-toggle "+this.options.controlButton.iconCssClass+(this.options.autohide?"":" close-button"),e=this._button=L.DomUtil.create("a",i,t);e.href="#",e.title=this.options.controlButton.title,this.options.collapsed&&(this._collapse(),this.options.autohide?L.DomEvent.on(t,"mouseover",this._expand,this).on(t,"mouseout",this._collapse,this):L.DomEvent.on(e,"click",L.DomEvent.stop).on(e,"click",this._toggle,this),L.DomEvent.on(e,"focus",this._toggle,this),this._map.on("click",this._collapse,this))}},_isObject:function(t){return t&&"object"==typeof t&&!Array.isArray(t)},_isJSONDoc:function(t,i){if(i=void 0===i||i,"string"==typeof t&&i)return 0==(t=t.trim()).indexOf("{")||0==t.indexOf("[");try{JSON.parse(t.toString())}catch(e){return!("object"!=typeof t||!i)||(console.warn(e),!1)}return!0},_isXMLDoc:function(t,i){if(i=void 0===i||i,"string"==typeof t&&i)return 0==(t=t.trim()).indexOf("<");var e=(t?t.ownerDocument||t:0).documentElement;return!!e&&"HTML"!==e.nodeName},_isDomVisible:function(t){return!!(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},_isVisible:function(t){if(!t)return!1;let i=window.getComputedStyle(t);return!!function(t,i){return"hidden"!==i.visibility&&"none"!==i.display}(0,i)&&!!function(t,i){let e=t.getBoundingClientRect(),a=e.left+1,s=e.right-1,o=e.top+1,n=(e.bottom,!0),r=t.style.pointerEvents;return"none"==i["pointer-events"]&&(t.style.pointerEvents="auto"),document.elementFromPoint(a,o)!==t&&(n=!1),document.elementFromPoint(s,o)!==t&&(n=!1),t.style.pointerEvents=r,n}(t,i)},_lazyLoadJS:function(t,i){return void 0===i&&(i=!1),i instanceof Promise?i:new Promise((function(e,a){if(i)return e();var s=document.createElement("script");s.addEventListener("load",e,{once:!0}),s.src=t,document.head.appendChild(s)}))},_mouseenterHandler:function(){this.fire&&this.fire("elechart_enter",null,!0),this._map&&this._map.fire("elechart_enter",null,!0)},_mousemoveHandler:function(t,i,e){if(this._data&&0!==this._data.length&&this._chartEnabled){var a=d3.mouse(this._focusRect.node())[0],s=this._data[this._findItemForX(a)];this._hidePositionMarker(),this._showDiagramIndicator(s,a),this._showPositionMarker(s),this._setMapView(s),this._map&&this._map._container&&L.DomUtil.addClass(this._map._container,"elechart-hover");var o={data:s};this.fire&&(this.fire("elechart_change",o,!0),this.fire("elechart_hover",o,!0)),this._map&&(this._map.fire("elechart_change",o,!0),this._map.fire("elechart_hover",o,!0))}},_mousemoveLayerHandler:function(t){if(this._data&&0!==this._data.length){var i=t.latlng,e=this._findItemForLatLng(i);if(e){var a=e.xDiagCoord;this._hidePositionMarker(),this._showDiagramIndicator(e,a),this._showPositionMarker(e)}}},_mouseoutHandler:function(){this.options.detached||this._hidePositionMarker(),this._map&&this._map._container&&L.DomUtil.removeClass(this._map._container,"elechart-hover"),this.fire&&this.fire("elechart_leave",null,!0),this._map&&this._map.fire("elechart_leave",null,!0)},_mousewheelHandler:function(t){if(!this._map.gestureHandling||!this._map.gestureHandling._enabled){var i=this._selectedItem?this._selectedItem.latlng:this._map.getCenter(),e=t.deltaY>0?this._map.getZoom()-1:this._map.getZoom()+1;this._resetDrag(),this._map.flyTo(i,e)}},_resetDrag:function(){this._dragRectangleG&&(this._dragRectangleG.remove(),this._dragRectangleG=null,this._dragRectangle=null,this._hidePositionMarker())},_resetView:function(){this._map&&this._map._isFullscreen||(this._resetDrag(),this._hidePositionMarker(),this.fitBounds(this._fullExtent))},_resizeChart:function(){if(this.options.responsive)if(this.options.detached){var t=this.eleDiv.offsetWidth;if(t<=0)return;this.options.width=t,this.eleDiv.innerHTML="",this.eleDiv.appendChild(this.onAdd(this._map))}else this._map.removeControl(this._container),this.addTo(this._map)},_showDiagramIndicator:function(t,i){if(this._chartEnabled){var e=this.options;this._focusG.style("visibility","visible"),this._mousefocus.attr("x1",i).attr("y1",0).attr("x2",i).attr("y2",this._height()).classed("hidden",!1);var a=t.z,s=t.dist,o=(t.latlng,e.hoverNumber.formatter(a,e.hoverNumber.decimalsY)),n=e.hoverNumber.formatter(s,e.hoverNumber.decimalsX);this._focuslabeltext.attr("y",this._y(t.z)).style("font-weight","700"),this._focuslabelX.text(n+" "+this._xLabel).attr("x",i+10),this._focuslabelY.text(o+" "+this._yLabel).attr("x",i+10);var r=this._focuslabeltext.node();if(this._isDomVisible(r)){var h=r.getBBox();this._focuslabelrect.attr("x",h.x-2).attr("y",h.y-2).attr("width",h.width+4).attr("height",h.height+4),i>=this._width()/2&&(this._focuslabelrect.attr("x",this._focuslabelrect.attr("x")-this._focuslabelrect.attr("width")-4-10),this._focuslabelX.attr("x",this._focuslabelX.attr("x")-this._focuslabelrect.attr("width")-4-10),this._focuslabelY.attr("x",this._focuslabelY.attr("x")-this._focuslabelrect.attr("width")-4-10))}}},_toggle:function(){L.DomUtil.hasClass(this._container,"elevation-expanded")?this._collapse():this._expand()},_setMapView:function(t){if(this.options.followMarker&&this._map){var i=this._map.getZoom();i=i<this._zFollow?this._zFollow:i,this._map.setView(t.latlng,i,{animate:!0,duration:.25})}},_showPositionMarker:function(t){this._selectedItem=t,this._map&&!this._map.getPane("elevationPane")&&(this._map.createPane("elevationPane"),this._map.getPane("elevationPane").style.zIndex=625,this._map.getPane("elevationPane").style.pointerEvents="none"),"elevation-line"==this.options.marker?this._updatePositionMarker(t):"position-marker"==this.options.marker&&this._updateLeafletMarker(t)},_updateAxis:function(){this._grid.selectAll("g").remove(),this._axis.selectAll("g").remove(),this._appendXGrid(this._grid),this._appendYGrid(this._grid),this._appendXaxis(this._axis),this._appendYaxis(this._axis)},_updateHeightIndicator:function(t){var i=this.options,e=i.hoverNumber.formatter(t.z,i.hoverNumber.decimalsY),a=(i.hoverNumber.formatter(t.dist,i.hoverNumber.decimalsX),this._height()/this._maxElevation*t.z),s=t.y-a;this._mouseHeightFocus.attr("x1",t.x).attr("x2",t.x).attr("y1",t.y).attr("y2",s).style("visibility","visible"),this._mouseHeightFocusLabel.attr("x",t.x).attr("y",s).text(e+" "+this._yLabel).style("visibility","visible")},_updateLeafletMarker:function(t){var i=t.latlng;this._marker?this._marker.setLatLng(i):(this._marker=new L.Marker(i,{icon:this.options.markerIcon,zIndexOffset:1e6}),this._marker.addTo(this._map,{pane:"elevationPane"}))},_updatePointG:function(t){this._pointG.attr("transform","translate("+t.x+","+t.y+")").style("visibility","visible")},_updatePositionMarker:function(t){var i=this._map.latLngToLayerPoint(t.latlng),e={dist:t.dist,x:i.x,y:i.y,z:t.z};if(!this._mouseHeightFocus){L.svg({pane:"elevationPane"}).addTo(this._map);var a=d3.select(this._map.getContainer()).select(".leaflet-elevation-pane svg");this._appendPositionMarker(a)}this._updatePointG(e),this._updateHeightIndicator(e)},_updateSummary:function(){if(this.options.summary&&this.summaryDiv&&(this.track_info=this.track_info||{},this.track_info.distance=this._distance||0,this.track_info.elevation_max=this._maxElevation||0,this.track_info.elevation_min=this._minElevation||0,d3.select(this.summaryDiv).html('<span class="totlen"><span class="summarylabel">'+L._("Total Length: ")+'</span><span class="summaryvalue">'+this.track_info.distance.toFixed(2)+" "+this._xLabel+'</span></span><span class="maxele"><span class="summarylabel">'+L._("Max Elevation: ")+'</span><span class="summaryvalue">'+this.track_info.elevation_max.toFixed(2)+" "+this._yLabel+'</span></span><span class="minele"><span class="summarylabel">'+L._("Min Elevation: ")+'</span><span class="summaryvalue">'+this.track_info.elevation_min.toFixed(2)+" "+this._yLabel+"</span></span>")),this.options.downloadLink&&this._downloadURL){var t=document.createElement("span");t.className="download";var i=document.createElement("a");i.innerHTML="Download",i.href="#",i.onclick=function(t){t.preventDefault();var i={confirm:this._saveFile.bind(this,this._downloadURL)},e=this.options.downloadLink;"modal"==e?("function"==typeof CustomEvent&&document.dispatchEvent(new CustomEvent("eletrack_download",{detail:i})),this.fire&&this.fire("eletrack_download",i),this._map&&this._map.fire("eletrack_download",i)):"link"!=e&&!0!==e||i.confirm()}.bind(this),this.summaryDiv.appendChild(t).appendChild(i)}},_width:function(){var t=this.options;return t.width-t.margins.left-t.margins.right}}),L.control.elevation=function(t){return new L.Control.Elevation(t)}}));
//# sourceMappingURL=leaflet-elevation.min.js.map
